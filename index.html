<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Breathe Please - A minimalist mindfulness application.">
    <title>Breathe Please</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><g transform=%22translate(50,50)%22 stroke=%22%23E69C85%22 stroke-width=%223%22 fill=%22none%22><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22/><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22 transform=%22rotate(60)%22/><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22 transform=%22rotate(120)%22/><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22 transform=%22rotate(180)%22/><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22 transform=%22rotate(240)%22/><path d=%22M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0%22 transform=%22rotate(300)%22/></g></svg>">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Asap:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Be+Vietnam+Pro:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Crimson+Pro:ital,wght@0,200..900;1,200..900&family=Inter:wght@300;400;500;600;700&family=Source+Sans+3:wght@300;400;500&display=swap');
        
        :root {
            /* --- LIGHT MODE PALETTE --- */
            --bg-color: #F0EEE9;          
            --text-color: #292A2D;        
            --subtle-text: #8C8B88;       
            --accent-happy: #E69C85;      
            --accent-text: #C67E69;
            --btn-active-text: #292A2D;   
            
            --modal-bg: rgba(240, 238, 233, 0.96); 
            --modal-shadow: rgba(41, 42, 45, 0.1);
            --modal-border: rgba(224, 222, 217, 0.5);
            
            --btn-border: rgba(230, 156, 133, 0.5); 
            --btn-hover-bg: rgba(230, 156, 133, 0.15);
            
            --ios-btn-bg: rgba(255, 255, 255, 0.6);
            --ios-btn-border: rgba(230, 156, 133, 0.4);
            --ios-btn-hover: #fff;
            --ios-btn-text: #292A2D;

            --control-bg: transparent; 
            --control-active-bg: #FFFFFF;
            
            --timer-color: #555659;

            /* --- 3D SPHERE PALETTE (Light) --- */
            --sphere-highlight: rgba(255, 255, 255, 1.0); 
            --sphere-mid: rgba(230, 156, 133, 0.65);        
            --sphere-shadow: rgba(160, 150, 145, 0.4);     
        }

        [data-theme="dark"] {
            /* --- DARK MODE PALETTE --- */
            --bg-color: #121212;          
            --text-color: #E5E5E5;        
            --subtle-text: #A3A3A3;       
            --accent-happy: #E69C85;
            --accent-text: #E69C85; 
            --btn-active-text: #E5E5E5;      
            --modal-bg: rgba(30, 30, 30, 0.96);
            --modal-shadow: rgba(0, 0, 0, 0.6);
            --modal-border: rgba(51, 51, 51, 0.5);
            
            --btn-border: rgba(230, 156, 133, 0.4);
            --btn-hover-bg: rgba(230, 156, 133, 0.15);

            --ios-btn-bg: rgba(255, 255, 255, 0.08);
            --ios-btn-border: rgba(230, 156, 133, 0.3);
            --ios-btn-hover: rgba(255, 255, 255, 0.15);
            --ios-btn-text: #E5E5E5;

            --control-bg: transparent; 
            --control-active-bg: #3A3A3A;
            --timer-color: #A3A3A3;

            /* --- 3D SPHERE (Dark) --- */
            --sphere-highlight: rgba(255, 230, 220, 0.35);
            --sphere-mid: rgba(230, 156, 133, 0.3);
            --sphere-shadow: rgba(0, 0, 0, 0.8);
        }

        [data-theme="blue"] {
            /* --- BLUE PALETTE --- */
            --bg-color: #0A1128;          
            --text-color: #E1E7F5;        
            --subtle-text: #8B9BB4;       
            --accent-happy: #4A90E2;      
            --accent-text: #5389C4; 
            --btn-active-text: #E1E7F5;      
            --modal-bg: rgba(10, 17, 40, 0.96);
            --modal-shadow: rgba(0, 0, 0, 0.6);
            --modal-border: rgba(28, 42, 74, 0.5);
            
            --btn-border: rgba(74, 144, 226, 0.4);
            --btn-hover-bg: rgba(74, 144, 226, 0.15);
            
            --ios-btn-bg: rgba(255, 255, 255, 0.08);
            --ios-btn-border: rgba(74, 144, 226, 0.3);
            --ios-btn-hover: rgba(255, 255, 255, 0.15);
            --ios-btn-text: #E1E7F5;

            --control-bg: transparent; 
            --control-active-bg: #1C2A4A;
            --timer-color: #8B9BB4;

            /* --- 3D SPHERE (Blue) --- */
            --sphere-highlight: rgba(180, 220, 255, 0.4); 
            --sphere-mid: rgba(15, 76, 129, 0.5);          
            --sphere-shadow: rgba(2, 5, 20, 0.7);          
        }

        [data-theme="green"] {
            /* --- GREEN PALETTE --- */
            --bg-color: #051916;          
            --text-color: #F0F2E8;        
            --subtle-text: #688F88;       
            --accent-happy: #009473;      
            --accent-text: #4DB6AC;  
            --btn-active-text: #E0F2F1;     
            --modal-bg: rgba(5, 25, 22, 0.96);
            --modal-shadow: rgba(0, 0, 0, 0.6);
            --modal-border: rgba(20, 61, 54, 0.5);

            --btn-border: rgba(77, 182, 172, 0.4);
            --btn-hover-bg: rgba(0, 148, 115, 0.15);

            --ios-btn-bg: rgba(255, 255, 255, 0.08);
            --ios-btn-border: rgba(77, 182, 172, 0.3);
            --ios-btn-hover: rgba(255, 255, 255, 0.15);
            --ios-btn-text: #F0F2E8;

            --control-bg: transparent; 
            --control-active-bg: #143D36;
            --timer-color: #688F88;

            /* --- 3D SPHERE (Green) --- */
            --sphere-highlight: rgba(180, 255, 240, 0.3);  
            --sphere-mid: rgba(0, 148, 115, 0.4);         
            --sphere-shadow: rgba(0, 15, 10, 0.7);          
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg-color); 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            position: relative;
            color: var(--text-color); 
            transition: background 0.5s ease, color 0.5s ease;
        }
        
        /* Background & Animation */
        .breathing-bg {
            position: fixed;
            top: 50%; left: 50%; 
            width: 55vmin; height: 55vmin; 
            border-radius: 50%;
            background: radial-gradient(circle at 25% 25%, 
                var(--sphere-highlight) 5%, 
                var(--sphere-mid) 50%, 
                var(--sphere-shadow) 90%,
                transparent 100%
            );
            z-index: 0; 
            pointer-events: none;
            filter: blur(30px); 
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.9; 
            will-change: transform, opacity;
            transition: background 0.5s ease, opacity 0.5s ease;
        }

        .breathing-active { 
            animation: breathe 12s cubic-bezier(0.45, 0, 0.55, 1) infinite; 
        }
        
        @keyframes breathe {
            0% { transform: translate(-50%, -50%) scale(0.85); opacity: 0.75; }
            33.333% { transform: translate(-50%, -50%) scale(1.85); opacity: 0.95; }
            66.666% { transform: translate(-50%, -50%) scale(1.85); opacity: 0.95; }
            100% { transform: translate(-50%, -50%) scale(0.85); opacity: 0.75; }
        }

        /* Interactive Liquid Ripple */
        .ripple-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1; 
        }

        .ripple-wave {
            position: absolute;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            will-change: width, height, opacity, box-shadow;
            border: 1px solid var(--sphere-highlight); 
            box-shadow: 0 0 15px 2px var(--sphere-mid), inset 0 0 10px 0 var(--sphere-highlight); 
            opacity: 0;
            pointer-events: none;
            animation: ripple-spread 2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes ripple-spread {
            0% { width: 10px; height: 10px; opacity: 0.6; border-width: 2px; }
            100% { width: 120vmax; height: 120vmax; opacity: 0; border-width: 0px; box-shadow: 0 0 50px 20px var(--sphere-shadow); }
        }

        /* --- HEADER LAYOUT --- */
        .header {
            padding: 40px 50px;
            position: fixed; top: 0; left: 0; width: 100%;
            height: 100px; 
            z-index: 100;
            display: flex; justify-content: space-between; align-items: center; 
            transition: opacity 0.5s ease;
        }
        
        .fullscreen-btn svg, 
        .info-icon svg,
        .setting-icon svg { 
            width: clamp(24px, 5vw, 28px); 
            height: clamp(24px, 5vw, 28px); 
            fill: currentColor; 
        }

        .sound-icon {
            width: clamp(22px, 5vw, 26px); 
            height: clamp(22px, 5vw, 26px); 
            fill: currentColor; display: block;
            transition: all 0.3s ease;
        }

        @keyframes button-breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        
        .fullscreen-btn {
            background: none; border: none; cursor: pointer; color: var(--subtle-text); 
            opacity: 0.8; transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
            padding: 6px; 
            width: 40px; height: 40px; 
        }
        .fullscreen-btn:hover { 
            color: var(--accent-happy); opacity: 1; 
            animation: button-breathe 3s ease-in-out infinite; 
        }

        /* Icon Switcher Logic */
        .fullscreen-btn .icon-compress { display: none; }
        .fullscreen-btn .icon-expand { display: block; }
        
        body.fullscreen-active .fullscreen-btn .icon-expand { display: none; }
        body.fullscreen-active .fullscreen-btn .icon-compress { display: block; }

        .app-title-header {
            position: absolute;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Asap', sans-serif;
            font-size: 0.85rem; 
            font-weight: 400; 
            color: var(--subtle-text); 
            opacity: 0.5; 
            letter-spacing: 0.5px;
            user-select: none;
            transition: opacity 0.5s ease;
            white-space: nowrap;
            z-index: 101; 
            text-shadow: 0 0 20px var(--bg-color); 
        }

        .info-btn {
            background: none; border: none; cursor: pointer; color: var(--subtle-text); 
            opacity: 0.8; 
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
            padding: 6px; 
            width: 40px; height: 40px; 
        }
        .info-btn:hover { 
            color: var(--accent-happy); opacity: 1; 
            animation: button-breathe 3s ease-in-out infinite;
        }

        body.fullscreen-active .bottom-bar,
        body.fullscreen-active .sound-control,
        body.fullscreen-active .app-title-header {
            opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        
        body.fullscreen-active .fullscreen-btn, 
        body.fullscreen-active .info-btn { 
            opacity: 0.5; 
            pointer-events: auto;
        }
        body.fullscreen-active .fullscreen-btn:hover,
        body.fullscreen-active .info-btn:hover { opacity: 1; }

        /* Modals */
        .info-overlay, .author-overlay, .intro-overlay, .disclaimer-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.2); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            z-index: 200; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
        }
        .info-overlay.active, .author-overlay.active, .disclaimer-overlay.active { opacity: 1; pointer-events: all; }
        
        .intro-overlay { 
            z-index: 300; background: var(--bg-color); backdrop-filter: none; 
            opacity: 1; pointer-events: all; 
            transition: opacity 1.5s ease, filter 1.5s ease, transform 1.5s ease; 
            filter: blur(0px); transform: scale(1);
        }
        .intro-overlay.hidden { opacity: 0; pointer-events: none; filter: blur(15px); transform: scale(1.05); }

        .info-box, .author-box, .intro-box, .disclaimer-box {
            background: var(--modal-bg);
            border-radius: 24px;
            box-shadow: 0 15px 50px var(--modal-shadow); 
            width: min(650px, 88vw); 
            max-height: 90svh; 
            text-align: center;
            transform: translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.3s ease;
            position: relative; border: 1px solid var(--modal-border);
            display: flex; flex-direction: column; overflow: hidden; padding: 0; 
        }
        
        .info-overlay.active .info-box, 
        .author-overlay.active .author-box,
        .intro-overlay .intro-box,
        .disclaimer-overlay.active .disclaimer-box { transform: translateY(0); }

        /* Panel Structure - Optimized for "Seamless Look" */
        .panel-header {
            padding: 30px 30px 10px 30px; /* More breathing room */
            flex-shrink: 0; 
        }
        
        .panel-scrollable-content {
            flex: 1; 
            overflow-y: auto; 
            padding: 5px 30px; /* Matches header padding for alignment */
            -webkit-overflow-scrolling: touch;
        }
        .panel-scrollable-content::-webkit-scrollbar { width: 4px; }
        .panel-scrollable-content::-webkit-scrollbar-thumb { background-color: var(--subtle-text); border-radius: 4px; }
        
        .panel-footer {
            display: flex;
            justify-content: space-between;
            align-items: center; 
            padding: 20px 30px 30px 30px; /* Balanced bottom padding */
            flex-shrink: 0; 
            background: transparent;
            z-index: 2;
        }

        .footer-left {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        .footer-right {
            text-align: right;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .intro-box {
            padding: clamp(40px, 8vmin, 80px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: min(550px, 88vw); max-height: 90svh; overflow-y: auto; 
        }

        .author-box, .disclaimer-box { padding: 0; }
        
        .author-list-container, .disclaimer-content {
            overflow-y: auto; margin-top: 15px;
            padding: 0 clamp(30px, 6vmin, 60px) 30px clamp(30px, 6vmin, 60px);
            text-align: left; flex: 1;
        }
        
        .author-box .info-title, .disclaimer-box .info-title {
            margin-top: clamp(35px, 6vmin, 50px);
            margin-bottom: 20px;
        }

        .author-item {
            font-family: 'Inter', sans-serif; font-size: 0.9em;
            color: var(--text-color); padding: 12px 0;
            border-bottom: 1px solid var(--modal-border);
        }
        .author-item:last-child { border-bottom: none; }

        .disclaimer-content h3 { font-family: 'Asap', sans-serif; font-size: 1em; margin-top: 25px; margin-bottom: 10px; color: var(--text-color); }
        .disclaimer-content h3:first-child { margin-top: 0; }
        .disclaimer-content p { font-family: 'Inter', sans-serif; font-size: 0.85em; color: var(--subtle-text); line-height: 1.6; margin-bottom: 15px; padding: 0; text-align: left; }

        .info-logo {
            margin: 0 auto 10px auto; display: block; fill: none; 
            stroke: var(--accent-happy); stroke-width: 2.5;
            stroke-linecap: round; stroke-linejoin: round; transition: stroke 0.5s ease;
            animation: lotus-spin 30s linear infinite;
        }
        .intro-box .info-logo { width: clamp(80px, 18vmin, 110px); height: clamp(80px, 18vmin, 110px); margin-bottom: clamp(30px, 6vmin, 50px); stroke-width: 2; }
        .info-box .info-logo { width: 36px; height: 36px; margin-bottom: 6px; }

        .info-title { font-family: 'Asap', sans-serif; font-size: 1.5em; color: var(--text-color); margin-bottom: 2px; font-weight: 600; }
        /* VERSION TEXT CSS */
        .info-version { font-family: 'Inter', sans-serif; font-size: 0.6em; color: var(--subtle-text); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-weight: 500; display: block; }
        
        .about-text-small {
            font-family: 'Inter', sans-serif; 
            font-size: 0.9rem; /* Increased size for readability */
            color: var(--subtle-text); 
            line-height: 1.6; /* Improved breathing room */
            margin-bottom: 5px; 
            margin-top: 5px;
            text-align: center; 
            opacity: 0.9;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .intro-main-text { 
            font-family: 'Inter', sans-serif; 
            font-size: clamp(0.8rem, 2.5vw, 0.95rem); /* Reduced subtitle size */
            color: var(--text-color); 
            line-height: 1.7; 
            margin-top: 0; 
            margin-bottom: clamp(20px, 4vmin, 30px); 
            padding: 0 clamp(10px, 3vw, 20px); 
            font-weight: 400; 
            max-width: 600px; 
        }
        
        /* Updated Title Color & Size in Intro Box */
        .intro-box .info-title {
            color: var(--accent-happy); /* Match Lotus */
            font-size: clamp(2rem, 5vw, 2.8rem); /* Larger Title */
            margin-bottom: 24px; /* Increased Spacing */
        }

        .intro-tweak-text {
            font-family: 'Inter', sans-serif; font-size: clamp(0.75rem, 2.5vw, 0.9rem); 
            color: var(--subtle-text); line-height: 1.6; 
            margin-bottom: clamp(40px, 8vmin, 60px); padding: 0 clamp(10px, 3vw, 20px); 
            font-weight: 400; max-width: 600px; opacity: 0.8;
        }

        .splash-actions { display: flex; flex-direction: column; align-items: center; gap: clamp(25px, 5vmin, 40px); margin-top: 0; width: 100%; }
        
        .splash-btn-group {
            display: flex; gap: 20px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .splash-checkbox-wrapper { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .splash-label { font-family: 'Inter', sans-serif; font-size: 0.8em; color: var(--subtle-text); font-weight: 400; }

        .start-btn {
            background: var(--ios-btn-bg);
            border: 1px solid var(--ios-btn-border);
            color: var(--ios-btn-text);
            padding: 10px 28px; 
            border-radius: 50px;
            cursor: pointer; font-family: 'Inter', sans-serif; 
            font-size: 0.9rem; 
            font-weight: 400; 
            transition: all 0.3s ease; 
            min-width: 140px;
            backdrop-filter: blur(12px);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .start-btn:hover { 
            background: var(--accent-happy); 
            color: #FFFFFF; 
            border-color: var(--accent-happy);
            transform: scale(1.03);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            animation: button-breathe 3s ease-in-out infinite;
        }

        .mode-icon-btn {
            padding: 12px;
            background: transparent; 
            border: none;
            color: var(--subtle-text); 
            cursor: pointer; 
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            border-radius: 50%;
            opacity: 0.9;
        }
        .mode-icon-btn:hover { 
            color: var(--accent-happy); 
            transform: scale(1.1);
            background: var(--btn-hover-bg);
            opacity: 1;
        }
        .mode-icon-btn:active { transform: scale(0.96); }

        .mode-icon {
            width: 28px; 
            height: 28px; 
            fill: currentColor;
            display: none; 
        }
        
        .info-footer-text { 
            font-size: clamp(0.7rem, 2vmin, 0.75rem); color: var(--subtle-text); 
            font-weight: 500; text-transform: none; letter-spacing: 0.5px; line-height: 1.6; 
        }

        .creator-link {
            color: var(--accent-text); text-decoration: none;
            border-bottom: 1px dotted var(--accent-text); transition: all 0.3s ease;
        }
        .creator-link:hover { color: var(--accent-happy); border-color: var(--accent-happy); opacity: 0.8; }

        .close-modal {
            position: absolute; top: 15px; right: 15px; background: none; border: none;
            cursor: pointer; color: var(--subtle-text); font-size: 24px; line-height: 1;
            transition: color 0.2s; padding: 5px; z-index: 10;
        }
        .close-modal:hover { color: var(--text-color); }

        .settings-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px; /* Increased Comfortable Spacing */
            width: 100%;
            margin-top: 10px;
        }

        .setting-row {
            display: grid;
            grid-template-columns: clamp(120px, 30vw, 150px) 1fr; 
            align-items: center;
            gap: 15px; 
            background: transparent;
            transition: opacity 0.4s ease;
            min-height: 44px; 
        }
        
        .setting-row.disabled-row {
            opacity: 0.3; 
            pointer-events: none;
            filter: grayscale(100%);
        }
        
        .setting-label {
            font-size: 0.75rem;
            color: var(--subtle-text); 
            font-weight: 600; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            text-align: left;
            white-space: nowrap;
            display: flex; align-items: center; gap: 8px;
        }
        
        .toggle-group {
            display: flex;
            gap: 6px; 
            width: 100%;
            flex-wrap: wrap; 
        }

        .toggle-btn {
            flex: 1;
            height: 28px; 
            font-size: 0.7rem; 
            padding: 0 8px;
            background: transparent; 
            border: 1px solid var(--btn-border); 
            color: var(--subtle-text); 
            border-radius: 50px; 
            cursor: pointer; 
            font-family: 'Inter', sans-serif; 
            font-weight: 400; 
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            white-space: nowrap;
            letter-spacing: 0.5px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .toggle-btn:hover { 
            background: var(--btn-hover-bg);
            color: var(--accent-text); 
            border-color: var(--accent-happy);
            transform: scale(1.02);
            box-shadow: 0 0 5px var(--btn-hover-bg);
        }
        
        .toggle-btn.active {
            background: var(--btn-hover-bg); 
            color: var(--text-color);
            border-color: var(--accent-happy);
            font-weight: 600;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        
        .toggle-btn.disabled {
             opacity: 0.5; pointer-events: none;
        }
        
        /* THEME BUTTON COLORS */
        #themeBtnLight { background-color: #F0EEE9; color: #292A2D; border: 1px solid rgba(140, 139, 136, 0.3); font-weight: 600; }
        #themeBtnDark  { background-color: #2D2D2D; color: #FFFFFF; border: 1px solid rgba(128, 128, 128, 0.4); font-weight: 500; }
        #themeBtnBlue  { background-color: #4A90E2; color: #FFFFFF; border: 1px solid rgba(139, 155, 180, 0.3); font-weight: 500; }
        #themeBtnGreen { background-color: #009473; color: #FFFFFF; border: 1px solid rgba(104, 143, 136, 0.3); font-weight: 500; }
        
        .toggle-btn.active#themeBtnLight,
        .toggle-btn.active#themeBtnDark,
        .toggle-btn.active#themeBtnBlue,
        .toggle-btn.active#themeBtnGreen {
             box-shadow: 0 0 0 2px var(--accent-happy), 0 4px 12px rgba(0,0,0,0.2);
             border-color: transparent;
             transform: scale(1.03);
        }

        #fontBtnSerif { font-family: 'Crimson Text', serif; font-size: 1rem; }
        #fontBtnSans  { font-family: 'Source Sans 3', sans-serif; font-weight: 400; }
        
        .waveform-icon { display: none; alignItems: flex-end; gap: 2px; height: 10px; margin-left: 2px; }
        #musicBtnOn.active .waveform-icon { display: inline-flex; }

        .waveform-icon span { display: block; width: 2px; background-color: currentColor; animation: wave 1s ease-in-out infinite; }
        .waveform-icon span:nth-child(1) { height: 6px; animation-delay: 0s; }
        .waveform-icon span:nth-child(2) { height: 10px; animation-delay: 0.1s; }
        .waveform-icon span:nth-child(3) { height: 7px; animation-delay: 0.2s; }

        @keyframes wave { 0%, 100% { height: 4px; } 50% { height: 100%; } }
        
        .btn-icon { width: 14px; height: 14px; }
        .setting-icon svg { width: 16px; height: 16px; }

        @keyframes icon-breathe-subtle { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        @keyframes icon-rotate-slow { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        #modeSwitchBtn .book-icon svg { animation: icon-breathe-subtle 4s ease-in-out infinite; }
        #modeSwitchBtn .sphere-icon svg { animation: icon-rotate-slow 10s linear infinite; }
        
        .line-control {
            display: flex; align-items: center; justify-content: space-between;
            position: relative; width: 100%; height: 28px; padding: 0;
        }
        
        .line-track {
            position: absolute; top: 50%; left: 10px; right: 10px;
            height: 1px; background: var(--subtle-text); opacity: 0.3;
            transform: translateY(-50%); z-index: 0;
        }

        .footer-action-btn {
            padding: 6px 16px; font-size: 0.7rem; background: transparent; 
            border: 1px solid var(--modal-border); color: var(--subtle-text); 
            border-radius: 50px; cursor: pointer; font-family: 'Inter', sans-serif; 
            font-weight: 500; transition: all 0.3s ease; letter-spacing: 0.5px;
            text-align: center;
        }
        .footer-action-btn:hover { border-color: var(--accent-happy); color: var(--text-color); background: var(--btn-hover-bg); }

        .theme-switch { position: relative; display: inline-block; width: 34px; height: 18px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 12px; width: 12px; left: 3px; bottom: 3px; background-color: white; transition: .4s; }
        input:checked + .slider { background-color: var(--accent-happy); }
        input:focus + .slider { box-shadow: 0 0 1px var(--accent-happy); }
        input:checked + .slider:before { transform: translateX(16px); }
        .slider.round { border-radius: 34px; }
        .slider.round:before { border-radius: 50%; }

        .lotus-container {
            position: absolute; top: 22%; left: 50%; transform: translate(-50%, -50%);
            z-index: 5; opacity: .7; pointer-events: auto; cursor: pointer; transition: opacity 0.3s;
        }
        .lotus-container:hover { opacity: 1; }
        .lotus-active { animation: lotus-breathe 12s ease-in-out infinite; }
        .lotus-icon { width: 40px; height: 40px; fill: none; stroke: var(--accent-happy); stroke-width: 3; stroke-linecap: round; stroke-linejoin: round; animation: lotus-spin 30s linear infinite; }
        @keyframes lotus-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .sound-control {
            position: fixed; bottom: 90px; left: 50px; z-index: 100;
            display: flex; align-items: center; gap: 12px; padding: 12px 16px;
            background: var(--modal-bg); backdrop-filter: blur(5px);
            border-radius: 8px; box-shadow: 0 4px 20px var(--modal-shadow);
            opacity: 0; pointer-events: none; transform: translateY(10px);
            transition: all 0.3s ease; font-family: 'Inter', sans-serif;
            border: 1px solid var(--modal-border);
        }
        .sound-control.visible { opacity: 1; pointer-events: all; transform: translateY(0); }
        .sound-label { font-size: 10px; color: var(--subtle-text); font-family: 'Inter', sans-serif; font-weight: 500; min-width: 35px; text-align: left; }
        .mute-btn { font-size: 16px; min-width: 24px; text-align: center; color: var(--subtle-text); cursor: pointer; background: none; border: none; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .mute-btn:active { transform: scale(0.9); }
        
        .sound-btn {
            padding: 12px; background: transparent; color: var(--subtle-text); 
            border: none; border-radius: 50%; display: flex; align-items: center; 
            justify-content: center; user-select: none; cursor: pointer; 
            opacity: 0.9; transition: all 0.3s ease; margin-left: 0;
            backdrop-filter: blur(4px);
        }
        .sound-btn:hover { color: var(--accent-text); background: var(--btn-hover-bg); opacity: 1; transform: scale(1.1); }
        .sound-btn:active { transform: scale(0.95); }
        .sound-btn.active { color: var(--subtle-text); }
        
        .sound-btn.playing .sound-icon { fill: var(--accent-happy); filter: drop-shadow(0 0 8px var(--accent-happy)); animation: icon-pulse-glow 1.5s ease-in-out infinite; }
        @keyframes icon-pulse-glow { 0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px var(--accent-happy)); opacity: 1; } 50% { transform: scale(1.15); filter: drop-shadow(0 0 12px var(--accent-happy)); opacity: 0.8; } }
        
        .container { flex: 1; position: relative; width: 100%; overflow: hidden; z-index: 10; pointer-events: none; }
        /* FIXED POSITION CENTER for Quote Box */
        .quote-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; max-width: 1000px; width: 100%; padding: 0 48px; pointer-events: auto; }
        .quote-box.no-author { top: 50%; }
        .quote-wrapper { position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        .quote-text.fs-2 { font-size: clamp(1.5rem, 3.2vw, 2.8rem); }
        .quote-text.fs-2.sans-mode { font-size: clamp(1.5rem, 3vw, 2.6rem); }
        .quote-text.fs-1 { font-size: clamp(1.1rem, 2.5vw, 2.0rem); }
        .quote-text.fs-1.sans-mode { font-size: clamp(1.1rem, 2.3vw, 1.9rem); }
        .quote-text.fs-3 { font-size: clamp(2.0rem, 4.5vw, 3.8rem); }
        .quote-text.fs-3.sans-mode { font-size: clamp(2.0rem, 4.3vw, 3.6rem); }

        .quote-text {
            font-family: 'Crimson Text', 'Crimson Pro', serif; 
            font-weight: 400; color: var(--text-color); padding: 0 50px; 
            line-height: 1.5em; margin: 0;
            transition: opacity 0.5s ease, font-family 0.3s ease, color 0.5s ease, font-size 0.5s ease; 
            opacity: 1; text-shadow: 0 1px 0 rgba(255,255,255,0.1); 
            user-select: none; word-spacing: 0.5px; cursor: pointer; 
        }
        
        .quote-text.sans-mode { font-family: 'Source Sans 3', sans-serif; font-weight: 400; letter-spacing: 0px; line-height: 1.5em; }
        .quote-text.force-sans { font-family: 'Source Sans 3', sans-serif !important; font-weight: 300 !important; letter-spacing: 0px; }
        .breathe-text-large { font-family: 'asap', sans-serif !important; font-size: clamp(3rem, 10vw, 5rem) !important; font-weight: 300 !important; }
        .quote-text.breathe-mode-active { opacity: 0.5 !important; transition: none !important; }
        
        [data-theme="dark"] .quote-text.sans-mode,
        [data-theme="blue"] .quote-text.sans-mode,
        [data-theme="green"] .quote-text.sans-mode { font-weight: 300; }
        
        .quote-author {
            /* REPLACED Absolute Positioning with Relative Logic for Better Sync */
            position: relative; 
            /* INCREASED MARGIN for substantial spacing */
            margin-top: 8vh; 
            width: 100%; text-align: center;
            font-size: 0.75em; color: var(--subtle-text); font-style: normal; font-family: 'Inter', sans-serif; font-weight: 400; letter-spacing: 1px; text-transform: uppercase;
            /* Transition handled by animation loop logic mostly */
            opacity: 0; 
            z-index: 10;
        }
        
        /* Helper class for immediate hiding */
        .instant-hide {
            opacity: 0 !important;
            transition: none !important;
        }

        .text-faded { opacity: 0 !important; }
        
        /* --- BOTTOM BAR --- */
        .bottom-bar {
            position: fixed; bottom: 40px; bottom: calc(40px + env(safe-area-inset-bottom));
            left: 50px; right: 50px; display: flex; justify-content: space-between;
            align-items: center; z-index: 50; opacity: 0.9; transition: opacity 0.5s ease;
            pointer-events: none; 
        }
        .bottom-bar > * { pointer-events: auto; } 
        .bottom-bar:hover { opacity: 1; }

        .controls-left, .controls-center, .controls-right { display: flex; align-items: center; }
        .controls-center { justify-content: center; flex: 1; text-align: center; }

        .breath-cycle-text { font-family: 'Asap', sans-serif; font-size: clamp(0.65rem, 1.5vmin, 0.75rem); font-weight: 400; color: var(--subtle-text); opacity: 0.5; letter-spacing: 0.5px; user-select: none; display: none; white-space: nowrap; }
        
        /* --- UPDATED TIMER CONTAINER & ANIMATIONS --- */
        
        @keyframes ring-expand {
            0%, 100% { 
                top: 0; left: 0; right: 0; bottom: 0; 
                border-width: 1px;
                opacity: 0.3;
            }
            50% { 
                top: -4px; left: -4px; right: -4px; bottom: -4px; 
                border-width: 1.5px;
                opacity: 0.9;
            }
        }

        .timer-container {
            /* ABSOLUTE POSITIONING RETAINED FOR STABILITY */
            position: absolute; 
            top: 75%; left: 50%; transform: translateX(-50%);
            
            display: flex; align-items: center; justify-content: center; 
            /* Reduced gap to tighten the center elements */
            gap: 4px; 
            
            color: var(--timer-color); 
            font-family: 'ASAP', sans-serif;
            font-weight: 700; 
            line-height: 1; 
            
            /* MODIFIED: STRICT HIDDEN DEFAULT */
            opacity: 0; 
            pointer-events: none;

            transition: opacity 0.5s ease; 
            letter-spacing: 1.5px;
            z-index: 10;
            
            /* Ring Size (Kept responsive & slightly larger as requested previously) */
            width: clamp(44px, 8vmin, 56px);
            height: clamp(44px, 8vmin, 56px);
            
            /* TEXT SIZE REDUCED for more padding */
            font-size: clamp(.85rem, 2vmin, 0.95rem);
        }
        
        /* Rotating & Breathing Ring */
        .timer-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%;
            border: 1px dashed var(--accent-happy);
            opacity: 0.75; 
            pointer-events: none;
            /* Transition reduced for snappy beep */
            transition: box-shadow 0.1s ease, opacity 0.1s ease;
            animation: 
                lotus-spin 30s linear infinite, 
                ring-expand 4s ease-in-out infinite;
        }

        /* Class to trigger ring glow beep - SUBTLE GLOW */
        .timer-container.timer-pulse-active::before {
             box-shadow: 0 0 8px 0px var(--accent-happy);
             opacity: 1;
        }

        body.fullscreen-active .timer-container { top: 75%; }
        /* Only visible if class added */
        .timer-container.visible { opacity: 0.8; pointer-events: auto; }
        
        /* ICON SIZE REDUCED for more padding */
        .timer-icon { 
            width: clamp(12px, 2.5vmin, 15px); 
            height: clamp(12px, 2.5vmin, 15px); 
            fill: none; 
            stroke: currentColor; 
            stroke-width: 1.5; 
            display: none !important;
        }
        
        .timer-digits { 
            display: inline-block; 
            min-width: 2ch; 
            text-align: center; 
            position: relative;
            top: 1px;
            /* Ensure text stays stable */
            transform: none !important;
            color: var(--timer-color) !important;
        }

        /* ... Keep existing Media Queries below ... */

        @media (max-width: 600px) {
            .header { padding: 25px 30px; }
            .info-btn { right: auto; top: auto; transform: none; } 
            .quote-box { padding: 0 20px; }
            .lotus-container { top: 20%; }
            .lotus-icon { width: 24px; height: 24px; }
            /* Adjusted for relative positioning context */
            .quote-author { font-size: 0.65em; margin-top: 5vh; } 
            .timer-container { top: 75%; font-size: 13px; }
            .bottom-bar { bottom: 30px; bottom: calc(30px + env(safe-area-inset-bottom)); left: 30px; right: 30px; gap: 10px; }
            .sound-btn { font-size: 12px; }
            .sound-control { left: 30px; bottom: 85px; bottom: calc(85px + env(safe-area-inset-bottom)); }

            .panel-header { padding: 20px 20px 0px 20px; }
            .panel-scrollable-content { padding: 0px 20px; }
            .panel-footer { padding: 10px 20px 20px 20px; }
            
            .setting-row { grid-template-columns: 80px 1fr; gap: 10px; }
            .label-wide { grid-template-columns: 1fr; margin-bottom: 5px; }
            .label-wide + .toggle-group { grid-column: 1 / -1; }
            
            .footer-left { width: 100%; margin-bottom: 10px; justify-content: center; }
            .footer-right { width: 100%; text-align: center; }
            .panel-footer { flex-direction: column; }
            
            .app-title-header { display: none; }
            
            /* HIDE BREATHING CYCLE TEXT ON MOBILE */
            #breathCycleIndicator { display: none !important; }
        }
    </style>
</head>
<body role="application">
    <div class="intro-overlay" id="splashModal">
        <div class="intro-box">
            <svg class="info-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <g transform="translate(50,50)">
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(0)"/>
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(60)"/>
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(120)"/>
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(180)"/>
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(240)"/>
                    <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(300)"/>
                </g>
            </svg>
            <div class="info-title">Breathe Please</div>
            <div class="intro-main-text">
                Slow visual breathing cues, reflective quotes, and a gentle 432 Hz sound designed to help you relax.
            </div>
            <div class="intro-tweak-text">
                Tweak your desired colors, fonts, and animation speed from settings menu.
            </div>
            <div class="splash-actions">
                <div class="splash-checkbox-wrapper">
                    <label class="theme-switch" for="startSoundCheck">
                        <input type="checkbox" id="startSoundCheck" checked>
                        <div class="slider round"></div>
                    </label>
                    <span class="splash-label">Play Sound</span>
                </div>
                
                <div class="splash-btn-group">
                    <button class="start-btn" onclick="startApp('breathe')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="9" stroke-dasharray="3 3"></circle>
                            <circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"></circle>
                        </svg>
                        Breathe
                    </button>
                    <button class="start-btn" onclick="startApp('read')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                        Read Quotes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="breathing-bg" id="breathingBg"></div>
    <div class="ripple-overlay" id="rippleContainer"></div>
    
    <div class="header">
        <button class="fullscreen-btn" id="fsToggle" aria-label="Toggle Fullscreen" onclick="toggleFullscreen()">
            <svg class="icon-expand" viewBox="0 0 24 24">
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
            </svg>
            <svg class="icon-compress" viewBox="0 0 24 24">
                <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-14v3h3v2h-5V5h2z"/>
            </svg>
        </button>
        
        <div class="app-title-header">Breathe Please</div>
        
        <button class="info-btn" id="infoBtn" aria-label="Settings & Info">
            <span class="info-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                </svg>
            </span>
        </button>
    </div>
    
    <div class="info-overlay" id="infoModal">
        <div class="info-box">
            <button class="close-modal" id="closeBtn">Ã—</button>
            <div class="panel-header">
                <svg class="info-logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(50,50)">
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(0)"/>
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(60)"/>
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(120)"/>
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(180)"/>
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(240)"/>
                        <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(300)"/>
                    </g>
                </svg>
                <div class="info-title">Breathe Please</div>
                <div class="info-version">Version 3.5 Stable</div>
                <div class="about-text-small">
                    A minimalist mindfulness app to help mitigate anxiety through rhythmic breathing and curated wisdom.
                </div>
            </div>

            <div class="panel-scrollable-content">
                <div class="settings-container">
                    <div class="setting-row">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M11.99 18.54l-7.37-5.73L3 14.07l9 7 9-7-1.63-1.27-7.38 5.74zM12 16l7.36-5.73L21 9l-9-7-9 7 1.63 1.27L12 16z"/>
                                </svg>
                            </span>
                            Mode
                        </div>
                        <div class="toggle-group">
                            <button class="toggle-btn" id="modeBtnBreathe" onclick="setMode('breathe')">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="9" stroke-dasharray="3 3"></circle>
                                    <circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"></circle>
                                </svg>
                                Breathe
                            </button>
                            <button class="toggle-btn active" id="modeBtnRead" onclick="setMode('read')">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                                </svg>
                                Read
                            </button>
                        </div>
                    </div>
                
                    <div class="setting-row">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2c-5.33 0-8 3.56-8 7.11 0 5.42 5.08 11.23 8 12.89 2.92-1.66 8-7.47 8-12.89C20 5.56 17.33 2 12 2z"/>
                                </svg>
                            </span>
                            Theme
                        </div>
                        <div class="toggle-group">
                            <button class="toggle-btn" id="themeBtnLight" onclick="setTheme('light')" aria-label="Light Theme">Creative</button>
                            <button class="toggle-btn" id="themeBtnDark" onclick="setTheme('dark')" aria-label="Dark Theme">Focus</button>
                            <button class="toggle-btn" id="themeBtnBlue" onclick="setTheme('blue')" aria-label="Blue Theme">Peace</button>
                            <button class="toggle-btn" id="themeBtnGreen" onclick="setTheme('green')" aria-label="Green Theme">Wise</button>
                        </div>
                    </div>

                    <div class="setting-row" id="settingRowFont">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z"/>
                                </svg>
                            </span>
                            Font
                        </div>
                        <div class="toggle-group">
                            <button class="toggle-btn active" id="fontBtnSerif" onclick="setFontStyle('serif')">Serif</button>
                            <button class="toggle-btn" id="fontBtnSans" onclick="setFontStyle('sans')">Sans</button>
                        </div>
                    </div>

                    <div class="setting-row" id="settingRowSize">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                     <path d="M21 19h-2.42l-1.27-3.58h-4.62l-1.28 3.58H9l5-14h2l5 14zm-4.32-5.06l-1.68-4.7-1.68 4.7h3.36zM3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2z"/>
                                </svg>
                            </span>
                            Size
                        </div>
                        <div class="toggle-group">
                            <button id="fsBtn1" class="toggle-btn" onclick="setFontSize(1)" aria-label="Small Size">Small</button>
                            <button id="fsBtn2" class="toggle-btn active" onclick="setFontSize(2)" aria-label="Medium Size">Medium</button>
                            <button id="fsBtn3" class="toggle-btn" onclick="setFontSize(3)" aria-label="Large Size">Large</button>
                        </div>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                </svg>
                            </span>
                            Volume
                        </div>
                        <div class="toggle-group">
                            <button id="volBtn1" class="toggle-btn" onclick="setVolumeLevel(1)" aria-label="Low Volume">Low</button>
                            <button id="volBtn2" class="toggle-btn active" onclick="setVolumeLevel(2)" aria-label="Mid Volume">Mid</button>
                            <button id="volBtn3" class="toggle-btn" onclick="setVolumeLevel(3)" aria-label="High Volume">High</button>
                        </div>
                    </div>

                    <div class="setting-row">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                                </svg>
                            </span>
                            Music
                        </div>
                        <div class="toggle-group">
                            <button class="toggle-btn active" id="musicBtnOff" onclick="toggleMusicState(false)">Off</button>
                            <button class="toggle-btn" id="musicBtnOn" onclick="toggleMusicState(true)">
                                On
                                <span class="waveform-icon">
                                    <span></span><span></span><span></span>
                                </span>
                            </button>
                        </div>
                    </div>

                    <div class="setting-row label-wide">
                        <div class="setting-label">
                            <span class="setting-icon">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
                                </svg>
                            </span>
                            Animation Speed
                        </div>
                        <div class="toggle-group">
                             <button class="toggle-btn" id="speedBtnSlow" onclick="setSpeed('slow')">Slow</button>
                             <button class="toggle-btn active" id="speedBtnFast" onclick="setSpeed('fast')">Fast</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-footer">
                <div class="footer-left">
                     <button class="footer-action-btn" id="authorListBtn">Acknowledgements</button>
                     <button class="footer-action-btn" id="disclaimerBtn">Disclaimer</button>
                </div>
                <div class="footer-right">
                    <div class="info-footer-text">
                        Designed by <a href="mailto:writetobjd@gmail.com" class="creator-link">Bhaskarjyoti Das</a>
                        <br>
                        &copy; 2025
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="author-overlay" id="authorModal">
        <div class="author-box">
            <button class="close-modal" id="closeAuthorBtn">Ã—</button>
            <div class="info-title">Quote Authors</div>
            <div class="author-list-container" id="authorList"></div>
        </div>
    </div>
    
    <div class="disclaimer-overlay" id="disclaimerModal">
        <div class="disclaimer-box">
             <button class="close-modal" id="closeDisclaimerBtn">Ã—</button>
             <div class="info-title">Disclaimer</div>
             <div class="disclaimer-content">
                 <h3>About Breathe Please</h3>
                 <p>Breathe Please is a minimalist web application designed to help users mitigate anxiety and overthinking through rhythmic breathing and curated wisdom. The app features a dynamic 3D-effect visual breather that guides your breathing pace, an extensive library of philosophical and psychological quotes from diverse sources including Buddha, Marcus Aurelius, and Rumi, and immersive ambient soundscapes. Built with HTML5, CSS3, and Vanilla JavaScript, Breathe Please offers visual customization through four professional themes (Light, Dark, Blue, and Green) and typography options, along with responsive audio controls and adjustable breathing animation speeds. This application is hosted and maintained on GitHub, with source code publicly available for transparency, collaboration, and community contribution. Developed by Bhaskarjyoti Das as an experiment exploring the creative potential of AI and mindfulness.</p>

                 <h3>Content Disclaimer</h3>
                 <p>All quotations and statements displayed within this application are attributed to their respective authors and original sources. Such content is provided solely for informational and inspirational purposes and does not constitute professional, medical, psychological, or legal advice. The creator and developer of this application make no representations, warranties, or guarantees regarding the accuracy, completeness, validity, or contextual appropriateness of any quoted material. The creator expressly disclaims all liability for any reliance upon, misinterpretation of, or application of such quotations by end users. Users acknowledge that they bear sole responsibility for any consequences arising from their interpretation, reliance upon, or use of the quoted content, and the creator assumes no liability whatsoever for such consequences.</p>

                 <h3>Music & Copyright Disclaimer</h3>
                 <p>The audio and musical compositions incorporated within this application consist of a combination of open-source licensed tracks and artificially generated audio content. The creator of this application does not claim, assert, or hold any proprietary rights, ownership interest, or copyright in the underlying musical works, compositions, or audio elements. All intellectual property rights in such music remain exclusively with their respective original creators, rights holders, and licensing entities. The creator makes no warranty regarding the lawfulness, licensing compliance, or non-infringing nature of any musical content, and users assume all risk and responsibility for any potential copyright or licensing issues arising from use of this application.</p>

                 <h3>Artificial Intelligence Assistance Disclaimer</h3>
                 <p>This web application's visual design, user interface, interaction architecture, and associated documentation have been developed with substantial assistance from third-party artificial intelligence and large language models, including but not limited to Google Gemini and Perplexity AI. Users acknowledge that AI-assisted development may introduce limitations, inaccuracies, inconsistencies, or unforeseen functional defects. The creator disclaims all warranties, express or implied, regarding the reliability, accuracy, or fitness for a particular purpose of any AI-assisted elements. The creator shall not be liable for any damages, losses, or claims arising from reliance upon or use of AI-assisted components.</p>

                 <h3>Privacy & Data Protection Disclaimer</h3>
                 <p>This application is designed and operated exclusively as a client-side web application that executes entirely within the user's web browser. The application does not intentionally collect, store, transmit, or process any personally identifiable information, user data, or personal content. However, users acknowledge that third partiesâ€”including but not limited to internet service providers, network operators, web browser software, operating system providers, and other intermediariesâ€”may collect, log, or process technical data (such as Internet Protocol addresses, browser identifiers, usage analytics, or device information) independent of and outside the control of this application or its creator. The creator assumes no responsibility for such third-party data processing and makes no representations regarding the privacy practices of such third parties. Users should consult the privacy policies of their respective service providers for complete information regarding data collection practices beyond the scope of this application.</p>
             </div>
        </div>
    </div>
    
    <div class="lotus-container" id="mainLotus">
        <svg class="lotus-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(50,50)">
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(0)"/>
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(60)"/>
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(120)"/>
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(180)"/>
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(240)"/>
                <path d="M0,0 C10,-20 10,-35 0,-45 C-10,-35 -10,-20 0,0" transform="rotate(300)"/>
            </g>
        </svg>
    </div>

    <div class="container">
        <div class="quote-box">
            <div class="quote-wrapper">
                <div class="quote-text fs-2" id="quoteText">The greatest glory in living lies not in never falling, but in rising every time we fall.</div>
                <div class="quote-author" id="quoteAuthor">Nelson Mandela</div>
            </div>
        </div>
    </div>
    
    <div id="breathingTimer" class="timer-container">
        <svg class="timer-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
        <span class="timer-digits" id="timerDigits">1</span>
    </div>

    <div class="bottom-bar">
        <div class="controls-left">
            <button class="sound-btn" id="soundBtn" onclick="toggleSoundState()">
                 <svg class="sound-icon" viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            </button>
        </div>

        <div class="controls-center">
             <div class="breath-cycle-text" id="breathCycleIndicator">Breathing cycle: 4 - 4 - 4</div>
        </div>

        <div class="controls-right">
            <button class="mode-icon-btn" id="modeSwitchBtn" onclick="toggleAppMode()" aria-label="Switch Mode" title="Change Mode">
                <div class="mode-icon book-icon">
                     <svg class="icon-svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                     </svg>
                </div>
                <div class="mode-icon sphere-icon">
                    <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="9" stroke-dasharray="3 3"></circle>
                        <circle cx="12" cy="12" r="4" fill="currentColor" stroke="none"></circle>
                    </svg>
                </div>
            </button>
        </div>
    </div>

    <div class="sound-control" id="soundControl">
        <button class="mute-btn" id="muteBtn" onclick="toggleMute()">ðŸ”‰</button>
        <input type="range" id="volumeSlider" class="volume-slider" min="1" max="3" step="1" value="2" oninput="setVolumeLevel(this.value)">
        <span class="sound-label" id="volumeLabel">Mid</span>
    </div>

    <audio id="track1" preload="auto" loop playsinline x-webkit-airplay="allow">
        <source src="mantra-om.mp3" type="audio/mpeg">
    </audio>
    <audio id="track2" preload="auto" loop playsinline x-webkit-airplay="allow">
        <source src="mantra-om.mp3" type="audio/mpeg">
    </audio>

    <script>
        const quotes = [
            { text: "The mind is everything. What you think, you become.", author: "Buddha" },
            { text: "Between stimulus and response there is a space. In that space is our power to choose our response.", author: "Viktor Frankl" },
            { text: "The ability to observe without evaluating is the highest form of intelligence.", author: "J. Krishnamurti" },
            { text: "You can't stop the waves, but you can learn to surf.", author: "Jon Kabat-Zinn" },
            { text: "I laugh when I hear that the fish in the water is thirsty.", author: "Kabir" },
            { text: "The antidote to overthinking isn't thinking less. It's rethinking more.", author: "Adam Grant" },
            { text: "There is nothing more important to true growth than realizing that you are not the voice of the mind â€” you are the one who hears it.", author: "Michael A. Singer" },
            { text: "We suffer more in imagination than in reality.", author: "Seneca" },
            { text: "Your worst enemy cannot harm you as much as your own unguarded thoughts.", author: "Gautama Buddha" },
            { text: "Nothing in life is as important as you think it is, while you are thinking about it.", author: "Daniel Kahneman" },
            { text: "The rich will make temples for Shiva. What shall I, a poor man, do? My legs are pillars, the body the shrine, the head a cupola of gold.", author: "Basavanna" },
            { text: "The problem is not thoughts themselves but the state of thinking without knowing that we are thinking.", author: "Sam Harris" },
            { text: "Rule your mind or it will rule you.", author: "Gautama Buddha" },
            { text: "The brain is like Velcro for negative experiences but Teflon for positive ones.", author: "Rick Hanson" },
            { text: "You have power over your mind, not outside events.", author: "Marcus Aurelius" },
            { text: "It is no measure of health to be well adjusted to a profoundly sick society.", author: "J. Krishnamurti" },
            { text: "Emotions are not reactions to the world; they are your constructions of the world.", author: "Lisa Feldman Barrett" },
            { text: "Leave your front door and your back door open. Allow your thoughts to come and go. Just don't serve them tea.", author: "Shunryu Suzuki" },
            { text: "Don't forget love; it will bring all the madness you need to unfurl yourself across the universe.", author: "Mirabai" },
            { text: "Where attention goes, neural firing flows, and neural connection grows.", author: "Dr. Dan Siegel" },
            { text: "The mind is like water. When turbulent, it's difficult to see. When it's calm, everything becomes clear.", author: "Confucius" },
            { text: "Establishment in the Self is the only source of peace.", author: "Thakur Anukulchandra" },
            { text: "Meditation is intermittent fasting for the mind.", author: "Naval Ravikant" },
            { text: "Imperfection is not our personal problem â€” it is a natural part of existing.", author: "Tara Brach" },
            { text: "The quieter you become, the more you can hear.", author: "Ram Dass" },
            { text: "To understand the immeasurable, the mind must be extraordinarily quiet and still.", author: "J. Krishnamurti" },
            { text: "Wherever you are, that's the entry point.", author: "Kabir" },
            { text: "Mind is the Master power that moulds and makes.", author: "James Allen" },
            { text: "You are the sky. Everything else â€“ it's just the weather.", author: "Matt Haig" },
            { text: "Don't believe everything you think.", author: "Unknown" },
            { text: "Compare yourself to who you were yesterday, not to who someone else is today.", author: "Jordan Peterson" },
            { text: "Analysis is paralysis.", author: "Unknown" },
            { text: "Life begins where fear ends.", author: "Osho" },
            { text: "Gratitude is the antidote to anxiety.", author: "Andrew Huberman" },
            { text: "God resides in those hearts in which there is no hatred towards anyone, there is no greed or malice.", author: "Guru Ravidas" },
            { text: "If a problem is fixable, there is no need to worry.", author: "Dalai Lama" },
            { text: "He who has a why to live can bear almost any how.", author: "Friedrich Nietzsche" },
            { text: "Worrying is like paying a debt you don't owe.", author: "Mark Twain" },
            { text: "Anxiety is the handmaiden of contemporary ambition.", author: "Alain de Botton" },
            { text: "Anxiety is the price of consciousness.", author: "Saul Bellow" },
            { text: "Things standing shall fall, but the moving ever shall stay.", author: "Basavanna" },
            { text: "Today I escaped anxiety. Or no, I discarded it, because it was within me.", author: "Marcus Aurelius" },
            { text: "The voice in your head is a fast talker.", author: "Ethan Kross" },
            { text: "Fear is a liar.", author: "Unknown" },
            { text: "Almost everything will work again if you unplug it for a few minutes, including you.", author: "Anne Lamott" },
            { text: "Do it afraid.", author: "Joyce Meyer" },
            { text: "Freedom from fear is the first of all virtues.", author: "Swami Vivekananda" },
            { text: "The present moment is the only moment available to us.", author: "Thich Nhat Hanh" },
            { text: "Fear is a natural reaction to moving closer to the truth.", author: "Pema ChÃ¶drÃ¶n" },
            { text: "Slowly, slowly, O mind, everything happens at its own pace.", author: "Kabir" },
            { text: "You are the world and the world is you.", author: "J. Krishnamurti" },
            { text: "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.", author: "Gautama Buddha" },
            { text: "Nature does not hurry, yet everything is accomplished.", author: "Lao Tzu" },
            { text: "Wherever you are, be there totally.", author: "Eckhart Tolle" },
            { text: "Sitting silently, doing nothing, spring comes, and the grass grows by itself.", author: "Basho" },
            { text: "When you walk, walk. When you eat, eat.", author: "Zen Proverb" },
            { text: "Breathe. It's only a moment.", author: "Unknown" },
            { text: "The greatest glory in living lies not in never falling, but in rising every time we fall.", author: "Nelson Mandela" },
            { text: "Arise! Awake! And stop not until the goal is reached.", author: "Swami Vivekananda" },
            { text: "Work without attachment is the beginning of spirituality.", author: "Ramakrishna Paramahamsa" },
            { text: "Vulnerability is not winning or losing; it's having the courage to show up and be seen when we have no control over the outcome.", author: "BrenÃ© Brown" },
            { text: "It is better to be an active fool than an idle wise!", author: "Thakur Anukulchandra" },
            { text: "Whatever you do, do it with your whole body and mind; be like a good bonfire.", author: "Shunryu Suzuki" },
            { text: "Words are the only jewels I possess.", author: "Tukaram" },
            { text: "Detach from the outcome, not the action.", author: "Bhagavad Gita" },
            { text: "The obstacle is the path.", author: "Zen Saying" },
            { text: "Plan out your work and then work out your plan.", author: "Swami Chinmayananda" },
            { text: "Be â€” don't try to become.", author: "Osho" },
            { text: "Truth is a pathless land.", author: "J. Krishnamurti" },
            { text: "You are not a drop in the ocean. You are the entire ocean in a drop.", author: "Rumi" },
            { text: "If your heart is pure, the water in your wooden tub is holy water.", author: "Guru Ravidas" },
            { text: "The privilege of a lifetime is to become who you truly are.", author: "Carl Jung" },
            { text: "Stop acting so small. You are the universe in ecstatic motion.", author: "Rumi" },
            { text: "Sell your cleverness and buy bewilderment.", author: "Rumi" },
            { text: "The wound is the place where the Light enters you.", author: "Rumi" },
            { text: "To love oneself is the beginning of a lifelong romance.", author: "Oscar Wilde" },
            { text: "We cannot direct the wind, but we can adjust our sails.", author: "Dolly Parton" },
            { text: "Rest my mind, rest on the feet of the Lord; release the confusion.", author: "Srimanta Sankardeva (Borgeet)" },
            { text: "The secret of change is to focus all of your energy not on fighting the old, but on building the new.", author: "Socrates" },
            { text: "The capacity to be alone is the capacity to love. It may look paradoxical to you, but it's not.", author: "Osho" },
            { text: "Your worst enemy cannot wish you more harm than your own unguarded thoughts.", author: "Buddha" },
            { text: "Seek not to change the world. Rather, seek to love it.", author: "Thich Nhat Hanh" },
            { text: "Tension is who you think you should be. Relaxation is who you are.", author: "Chinese Proverb" },
            { text: "Energy flows where attention goes.", author: "James Redfield" },
            { text: "The only person you are destined to become is the person you decide to be.", author: "Ralph Waldo Emerson" },
            { text: "Your task is not to seek for love, but merely to seek and find all the barriers within yourself that you have built against it.", author: "Rumi" },
            { text: "Sometimes the smallest things take up the most room in your heart.", author: "A.A. Milne" },
            { text: "Being happy doesn't mean everything is perfect. It means you've decided to look beyond the imperfections.", author: "Unknown" },
            { text: "Still waters run deep.", author: "Proverb" },
            { text: "Your inner peace is worth more than winning any argument.", author: "Unknown" }
        ];
        
        let availableQuotes = [];
        let currentQuoteIndex = -1;
        
        let track1, track2;
        let activeTrack = null;
        let isGlobalPlaying = false;
        let isCrossfading = false;
        const CROSSFADE_TIME = 4; 
        
        const volumeMap = { 1: 0.05, 2: 0.2, 3: 0.4 };
        const labelMap = { 1: "Low", 2: "Mid", 3: "High" };
        
        /* UPDATED DEFAULT VOLUME TO 2 (MID) */
        let currentVolumeLevel = 2; 
        let isMuted = false;

        let isDynamicTheme = true;

        let updateInterval = 1; 
        let cycleCounter = 0;
        let appMode = 'read'; 

        const infoBtn = document.getElementById('infoBtn');
        const infoModal = document.getElementById('infoModal');
        const closeBtn = document.getElementById('closeBtn');
        const authorListBtn = document.getElementById('authorListBtn');
        const authorModal = document.getElementById('authorModal');
        const closeAuthorBtn = document.getElementById('closeAuthorBtn');
        const mainLotus = document.getElementById('mainLotus');
        
        const disclaimerBtn = document.getElementById('disclaimerBtn');
        const disclaimerModal = document.getElementById('disclaimerModal');
        const closeDisclaimerBtn = document.getElementById('closeDisclaimerBtn');

        function openInfoPanel(e) {
            e.stopPropagation();
            infoModal.classList.add('active');
        }
        
        function closeInfoPanel() {
            infoModal.classList.remove('active');
        }

        infoBtn.addEventListener('click', openInfoPanel);
        
        closeBtn.addEventListener('click', (e) => { e.stopPropagation(); closeInfoPanel(); });
        
        infoModal.addEventListener('click', (e) => { 
            const isInteractive = e.target.closest('button') || 
                                  e.target.closest('input') || 
                                  e.target.closest('label') ||
                                  e.target.closest('a');
            if (!isInteractive) {
                closeInfoPanel();
            }
        });

        authorListBtn.addEventListener('click', (e) => { e.stopPropagation(); populateAuthorList(); authorModal.classList.add('active'); });
        closeAuthorBtn.addEventListener('click', (e) => { e.stopPropagation(); authorModal.classList.remove('active'); });
        authorModal.addEventListener('click', (e) => { if (e.target === authorModal) authorModal.classList.remove('active'); });
        
        disclaimerBtn.addEventListener('click', (e) => { e.stopPropagation(); disclaimerModal.classList.add('active'); });
        closeDisclaimerBtn.addEventListener('click', (e) => { e.stopPropagation(); disclaimerModal.classList.remove('active'); });
        disclaimerModal.addEventListener('click', (e) => { if (e.target === disclaimerModal) disclaimerModal.classList.remove('active'); });

        function populateAuthorList() {
            const listContainer = document.getElementById('authorList');
            const authors = [...new Set(quotes.map(q => q.author))].sort();
            listContainer.innerHTML = '';
            authors.forEach(author => {
                const div = document.createElement('div');
                div.className = 'author-item';
                // SECURITY FIX: textContent used instead of innerHTML
                div.textContent = author;
                listContainer.appendChild(div);
            });
        }
        
        let cycleStartTime = performance.now();
        const CYCLE_DURATION = 12000;

        function setMode(mode) {
            appMode = mode;
            const btnBreathe = document.getElementById('modeBtnBreathe');
            const btnRead = document.getElementById('modeBtnRead');
            const quoteText = document.getElementById('quoteText');
            const quoteAuthor = document.getElementById('quoteAuthor');
            const breathingTimer = document.getElementById('breathingTimer');
            const breathCycleIndicator = document.getElementById('breathCycleIndicator'); 
            const fsBtns = [document.getElementById('fsBtn1'), document.getElementById('fsBtn2'), document.getElementById('fsBtn3')];
            
            const bookIcon = document.querySelector('.book-icon');
            const sphereIcon = document.querySelector('.sphere-icon');
            
            // Setting Row Elements for Fading
            const fontRow = document.getElementById('settingRowFont');
            const sizeRow = document.getElementById('settingRowSize');

            if (mode === 'breathe') {
                // BREATHE MODE
                btnBreathe.classList.add('active');
                btnRead.classList.remove('active');
                
                // Fade out Font and Size settings
                fontRow.classList.add('disabled-row');
                sizeRow.classList.add('disabled-row');

                bookIcon.style.display = 'block';
                sphereIcon.style.display = 'none';
                
                // APPLY INSTANT HIDE CLASS
                quoteAuthor.classList.add('instant-hide'); 
                quoteText.classList.add('instant-hide');
                
                // Ensure display block is set so opacity can work if we switch back, 
                // but the instant-hide class forces opacity 0
                quoteAuthor.style.display = 'block'; 
                
                fsBtns.forEach(btn => btn.classList.add('disabled'));
                
                // Reset styling for Breathe Mode
                quoteText.style.transition = 'none'; 
                quoteText.style.opacity = '0';
                
                quoteText.classList.add('force-sans');
                quoteText.classList.add('breathe-mode-active');
                quoteText.classList.add('breathe-text-large');
                
                breathingTimer.classList.add('visible'); 
                breathCycleIndicator.style.display = 'block'; 
                
            } else {
                // READ MODE - INSTANT SWITCH
                btnRead.classList.add('active');
                btnBreathe.classList.remove('active');
                
                // Restore Font and Size settings
                fontRow.classList.remove('disabled-row');
                sizeRow.classList.remove('disabled-row');
                
                sphereIcon.style.display = 'block';
                bookIcon.style.display = 'none';
                
                breathingTimer.classList.remove('visible'); 
                breathCycleIndicator.style.display = 'none'; 
                
                // REMOVE INSTANT HIDE CLASS
                quoteAuthor.classList.remove('instant-hide');
                quoteText.classList.remove('instant-hide');
                
                quoteText.classList.remove('force-sans');
                quoteText.classList.remove('breathe-mode-active');
                quoteText.classList.remove('breathe-text-large');

                quoteAuthor.style.display = 'block'; 
                fsBtns.forEach(btn => btn.classList.remove('disabled'));
                
                // --- INSTANT DISPLAY LOGIC ---
                // 1. Remove transition so opacity jumps
                quoteText.style.transition = 'none'; 
                // 2. Force Opacity to 1 immediately
                quoteText.style.opacity = '1';
                // 3. Reset Transforms
                quoteText.style.letterSpacing = '0px'; 
                quoteText.style.transform = 'scale(1)';
                
                displayQuote(); 
            }
            closeInfoPanel();
        }

        function toggleAppMode() {
            if (appMode === 'read') {
                setMode('breathe');
            } else {
                setMode('read');
            }
        }
        
        let lastSeconds = -1;

        function animationLoop() {
            requestAnimationFrame(animationLoop);
            
            const now = performance.now();
            const elapsed = (now - cycleStartTime) % CYCLE_DURATION;
            const textEl = document.getElementById('quoteText');
            
            if (appMode === 'breathe') {
                const timerEl = document.getElementById('timerDigits');
                const breathingTimer = document.getElementById('breathingTimer');
                
                let targetText = "";
                let scaleVal = 1;
                let letterSpacingVal = 0; 
                let shakeX = 0;
                let shakeY = 0;
                
                // TIMER LOGIC: 1 to 12
                let currentSec = Math.floor(elapsed / 1000) + 1;
                if (currentSec > 12) currentSec = 1;
                
                if (currentSec !== lastSeconds) {
                    timerEl.textContent = currentSec; 
                    lastSeconds = currentSec;
                    
                    // Trigger Ring Pulse on 1, 5, 9
                    if(currentSec === 1 || currentSec === 5 || currentSec === 9) {
                        breathingTimer.classList.add('timer-pulse-active');
                        // Remove class shortly after to allow re-trigger
                        setTimeout(() => {
                             breathingTimer.classList.remove('timer-pulse-active');
                        }, 200); // FASTER BEEP: 200ms
                    }
                }
                
                if (elapsed < 4000) {
                    targetText = "Inhale";
                    let p = elapsed / 4000; 
                    let ease = -(Math.cos(Math.PI * p) - 1) / 2;
                    scaleVal = 1 + (0.85 * ease);
                    letterSpacingVal = 4 * ease;
                    
                } else if (elapsed < 8000) {
                    targetText = "Hold";
                    scaleVal = 1.85;
                    letterSpacingVal = 4;
                    
                    // VIBRATION LOGIC FOR "HOLD" - UPDATED
                    // Stop vibration at 7600ms (400ms before Exhale) for stillness
                    if (elapsed < 7600) {
                        const vibrationIntensity = 0.4; // Subtle intensity
                        shakeX = (Math.random() - 0.5) * vibrationIntensity;
                        shakeY = (Math.random() - 0.5) * vibrationIntensity;
                    } else {
                        shakeX = 0;
                        shakeY = 0;
                    }
                    
                } else {
                    targetText = "Exhale";
                    let p = (elapsed - 8000) / 4000;
                    let ease = p < 0.5 ? 4 * p * p * p : 1 - Math.pow(-2 * p + 2, 3) / 2;
                    scaleVal = 1.85 - (0.85 * ease);
                    letterSpacingVal = 4 - (4 * ease);
                }
                
                if (textEl.textContent !== targetText) {
                     textEl.textContent = targetText;
                }
                
                // Updated Transform with Vibration
                textEl.style.transform = `scale(${scaleVal}) translate(${shakeX}px, ${shakeY}px)`;
                textEl.style.letterSpacing = `${letterSpacingVal}px`;
                textEl.style.opacity = 0.5; 
            } 
            else if (appMode === 'read') {
                // READ MODE LOGIC
                // Logic: 
                // 1. Fade In only at very start of a visual cycle
                // 2. Fade Out only at very end of a visual cycle
                // 3. Otherwise stay visible (opacity 1)
                
                const timeInCurrentCycle = elapsed; 
                const authorEl = document.getElementById('quoteAuthor');
                
                if (timeInCurrentCycle < 1500) {
                     // Fade In Phase
                     textEl.style.opacity = timeInCurrentCycle / 1500;
                     // Author Delayed Fade In (Start at 1000ms, end at 2500ms, max 0.6 opacity)
                     if (timeInCurrentCycle < 1000) {
                         authorEl.style.opacity = 0;
                     } else {
                         authorEl.style.opacity = ((timeInCurrentCycle - 1000) / 1500) * 0.6;
                     }
                } 
                else if (timeInCurrentCycle > 10000 && (cycleCounter + 1) >= updateInterval) {
                     // Fade Out Phase (only if we are about to switch quotes)
                     const fadeOutProgress = (timeInCurrentCycle - 10000) / 2000;
                     const opacity = 1 - fadeOutProgress;
                     textEl.style.opacity = opacity;
                     authorEl.style.opacity = opacity * 0.6; // Scale down from max 0.6
                } 
                else {
                    // Stable Phase - Ensure Visibility
                    textEl.style.opacity = 1;
                    authorEl.style.opacity = 0.6; // Capped Opacity
                }
            }
        }

        function checkDynamicTheme() {
            if (!isDynamicTheme) return;
            const hour = new Date().getHours();
            if (hour >= 6 && hour < 18) {
                setTheme('light', true); 
            } else {
                setTheme('blue', true); 
            }
        }

        function setTheme(mode, isInternalCall = false) {
            const body = document.body;
            
            const btns = ['Light', 'Dark', 'Blue', 'Green'];
            btns.forEach(b => {
                const el = document.getElementById('themeBtn' + b);
                if(el) el.classList.remove('active');
            });
            
            if (!isInternalCall && mode !== 'dynamic') {
                isDynamicTheme = false;
            } else if (mode === 'dynamic') {
                isDynamicTheme = true;
                checkDynamicTheme(); 
                return; 
            }
            
            if (mode === 'light') body.removeAttribute('data-theme');
            else body.setAttribute('data-theme', mode);
            
            if (mode === 'blue' || mode === 'green') setFontStyle('sans', true); 
            else setFontStyle('serif', true); 
            
            const activeBtn = document.getElementById('themeBtn' + mode.charAt(0).toUpperCase() + mode.slice(1));
            if(activeBtn) activeBtn.classList.add('active');

            if(!isInternalCall) closeInfoPanel();
        }

        function setSpeed(speedMode) {
            const btnSlow = document.getElementById('speedBtnSlow');
            const btnFast = document.getElementById('speedBtnFast');

            if (speedMode === 'slow') {
                updateInterval = 2; 
                btnSlow.classList.add('active');
                btnFast.classList.remove('active');
            } else {
                updateInterval = 1; 
                btnFast.classList.add('active');
                btnSlow.classList.remove('active');
            }
             
             closeInfoPanel();
        }

        function setFontStyle(mode, isInternalCall = false) {
            const text = document.getElementById('quoteText');
            const isCurrentlySans = text.classList.contains('sans-mode');
            
            if ((mode === 'sans' && isCurrentlySans) || (mode === 'serif' && !isCurrentlySans)) return;

            if (mode === 'sans') text.classList.add('sans-mode');
            else text.classList.remove('sans-mode');
            updateFontUI();
            
            if(!isInternalCall) closeInfoPanel();
        }

        function updateFontUI() {
            const text = document.getElementById('quoteText');
            const btnSerif = document.getElementById('fontBtnSerif');
            const btnSans = document.getElementById('fontBtnSans');
            const isSans = text.classList.contains('sans-mode');
            
            if (isSans) {
                btnSans.classList.add('active');
                btnSerif.classList.remove('active');
            } else {
                btnSerif.classList.add('active');
                btnSans.classList.remove('active');
            }
        }
        
        function setFontSize(level) {
            if(appMode === 'breathe') return; 
            const text = document.getElementById('quoteText');
            const btns = [document.getElementById('fsBtn1'), document.getElementById('fsBtn2'), document.getElementById('fsBtn3')];
            text.classList.remove('fs-1', 'fs-2', 'fs-3');
            text.classList.add('fs-' + level);
            btns.forEach((btn, index) => {
                if(index + 1 === level) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            closeInfoPanel();
        }

        function setVolumeLevel(step) {
            currentVolumeLevel = parseInt(step);
            isMuted = false; 
            updateVolumeUI();
            if (activeTrack && !isCrossfading) {
                const targetVol = volumeMap[currentVolumeLevel];
                activeTrack.volume = targetVol;
            }
            closeInfoPanel();
        }

        function toggleMute() {
            isMuted = !isMuted;
            updateVolumeUI();
            updateSoundButtonState(); 
            if (activeTrack) {
                activeTrack.volume = isMuted ? 0 : volumeMap[currentVolumeLevel];
            }
            if (track1) track1.muted = isMuted;
            if (track2) track2.muted = isMuted;
        }

        function toggleMusicState(turnOn) {
            if (turnOn) {
                if (!isGlobalPlaying) startAudio();
                else if (isMuted) toggleMute();
            } else {
                if (!isMuted && isGlobalPlaying) toggleMute();
            }
            closeInfoPanel();
        }
        
        function updateMusicToggleUI() {
            const isMusicOn = isGlobalPlaying && !isMuted;
            const btnOn = document.getElementById('musicBtnOn');
            const btnOff = document.getElementById('musicBtnOff');
            
            if (isMusicOn) {
                btnOn.classList.add('active');
                btnOff.classList.remove('active');
            } else {
                btnOff.classList.add('active');
                btnOn.classList.remove('active');
            }
        }

        function updateVolumeUI() {
            const popupSlider = document.getElementById('volumeSlider');
            const label = document.getElementById('volumeLabel');
            const muteBtn = document.getElementById('muteBtn');
            const btns = [document.getElementById('volBtn1'), document.getElementById('volBtn2'), document.getElementById('volBtn3')];
            
            if (isMuted) {
                muteBtn.textContent = 'ðŸ”‡'; 
                if(label) label.textContent = 'Mute'; 
                if(popupSlider) popupSlider.classList.add('disabled');
                btns.forEach(btn => btn.classList.add('disabled'));
            } else {
                muteBtn.textContent = 'ðŸ”‰'; 
                if(label) label.textContent = labelMap[currentVolumeLevel]; 
                if(popupSlider) {
                    popupSlider.classList.remove('disabled'); 
                    popupSlider.value = currentVolumeLevel;
                }
                btns.forEach((btn, index) => {
                    btn.classList.remove('disabled');
                    if ((index + 1) === currentVolumeLevel) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
            updateMusicToggleUI();
        }
        
        function updateSoundButtonState() {
            const btn = document.getElementById('soundBtn');
            const isPlaying = isGlobalPlaying && !isMuted;
            
            if (isPlaying) {
                btn.classList.add('playing');
            } else {
                btn.classList.remove('playing');
            }
            updateMusicToggleUI();
        }
        
        function toggleSoundState() {
            if (!isGlobalPlaying) {
                startAudio();
            } else {
                toggleMute();
            }
        }

        function triggerRipple(x, y) {
            const container = document.getElementById('rippleContainer');
            const finalX = x !== undefined ? x : window.innerWidth / 2;
            const finalY = y !== undefined ? y : window.innerHeight / 2;

            for (let i = 0; i < 2; i++) { 
                setTimeout(() => {
                    const ripple = document.createElement('div');
                    ripple.classList.add('ripple-wave');
                    ripple.style.left = finalX + 'px';
                    ripple.style.top = finalY + 'px';
                    container.appendChild(ripple);
                    setTimeout(() => ripple.remove(), 2000); 
                }, i * 100); 
            }
        }

        function initAudio() {
            track1 = document.getElementById('track1');
            track2 = document.getElementById('track2');
            track1.volume = volumeMap[currentVolumeLevel];
            track2.volume = 0; 
            track1.addEventListener('timeupdate', () => checkGaplessLoop(track1, track2));
            track2.addEventListener('timeupdate', () => checkGaplessLoop(track2, track1));
            activeTrack = track1;
        }

        function checkGaplessLoop(current, next) {
            if (!isGlobalPlaying) return;
            if (isCrossfading) return;
            if (isNaN(current.duration)) return;
            let timeLeft = current.duration - current.currentTime;
            if (timeLeft <= CROSSFADE_TIME && timeLeft > 0) {
                isCrossfading = true;
                next.currentTime = 0; next.volume = 0;
                next.play().catch(e => {
                    console.error("Audio loop failed", e);
                    isCrossfading = false;
                });
                performEqualPowerCrossfade(current, next);
            }
        }

        function performEqualPowerCrossfade(outgoing, incoming) {
            const intervalStep = 50; 
            const steps = (CROSSFADE_TIME * 1000) / intervalStep;
            let counter = 0;
            const fadeInterval = setInterval(() => {
                if (!isGlobalPlaying) { clearInterval(fadeInterval); isCrossfading = false; return; }
                const maxVolNow = isMuted ? 0 : volumeMap[currentVolumeLevel];
                let ratio = counter / steps; 
                let gainIn = Math.sin(ratio * Math.PI / 2);
                let gainOut = Math.cos(ratio * Math.PI / 2);
                incoming.volume = maxVolNow * gainIn;
                outgoing.volume = maxVolNow * gainOut;
                counter++;
                if (counter >= steps) {
                    clearInterval(fadeInterval);
                    outgoing.pause(); outgoing.currentTime = 0; outgoing.volume = 0; 
                    incoming.volume = maxVolNow; activeTrack = incoming; isCrossfading = false;
                }
            }, intervalStep);
        }

        function startAudio() {
            if (!track1 || !track2) initAudio();
            isGlobalPlaying = true;
            const startVol = isMuted ? 0 : volumeMap[currentVolumeLevel];
            if (!activeTrack) activeTrack = track1;
            activeTrack.volume = startVol;
            activeTrack.play().then(() => {
                updateSoundButtonState();
            }).catch(e => {
                console.log("Autoplay blocked or file missing", e);
                isGlobalPlaying = false; 
                updateSoundButtonState();
            });
        }
        
        function startApp(mode) {
            setMode(mode); 
            document.getElementById('splashModal').classList.add('hidden');
            
            const bg = document.getElementById('breathingBg');
            const lotus = document.querySelector('.lotus-container');
            
            bg.classList.add('breathing-active');
            
            requestAnimationFrame(() => {
                cycleStartTime = performance.now(); 
            });
            
            lotus.classList.add('lotus-active');
            requestAnimationFrame(animationLoop);

            if (!track1 || !track2) initAudio();
            
            track1.load();
            track2.load();

            const unlock1 = track1.play().then(() => {
                track1.pause();
                track1.currentTime = 0;
            }).catch(e => console.log("Unlock 1 failed", e));

            const unlock2 = track2.play().then(() => {
                track2.pause();
                track2.currentTime = 0;
            }).catch(e => console.log("Unlock 2 failed", e));
            
            Promise.all([unlock1, unlock2]).then(() => {
                 const shouldPlaySound = document.getElementById('startSoundCheck').checked;
                 if (shouldPlaySound) {
                     startAudio();
                 } else {
                     updateSoundButtonState();
                 }
            });
        }

        document.body.addEventListener('click', (e) => {
            if (e.target.closest('button') || 
                e.target.closest('input') || 
                e.target.closest('.info-box') || 
                e.target.closest('.intro-box') ||
                e.target.closest('.author-box') ||
                e.target.closest('.disclaimer-box')) {
                return;
            }
            triggerRipple(e.clientX, e.clientY);
        });

        function displayQuote() {
            if (currentQuoteIndex === -1) return;
            const quote = quotes[currentQuoteIndex];
            const quoteText = document.getElementById('quoteText');
            const quoteAuthor = document.getElementById('quoteAuthor');
            const quoteBox = document.querySelector('.quote-box');
            
            quoteText.textContent = quote.text;
            if (quote.author && quote.author.toLowerCase() !== 'unknown') {
                quoteAuthor.textContent = quote.author; 
                quoteBox.classList.remove('no-author'); 
            } else {
                quoteAuthor.style.display = 'none'; 
                quoteBox.classList.add('no-author'); 
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function refillQuotes() {
            let pool = [];
            for (let i = 0; i < quotes.length; i++) { pool.push(i); }
            shuffleArray(pool);
            availableQuotes = pool;
            if (availableQuotes.length > 1 && currentQuoteIndex !== -1) {
                const prevAuthor = quotes[currentQuoteIndex].author;
                if (quotes[availableQuotes[0]].author === prevAuthor) {
                    let temp = availableQuotes[0];
                    availableQuotes[0] = availableQuotes[1];
                    availableQuotes[1] = temp;
                }
            }
        }

        function getNewQuote() {
            if (availableQuotes.length === 0) { refillQuotes(); }
            const quoteIndex = availableQuotes.shift();
            currentQuoteIndex = quoteIndex;
            displayQuote();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                document.body.classList.add('fullscreen-active');
            } else {
                document.body.classList.remove('fullscreen-active');
            }
        });
        
        window.addEventListener('load', function() {
            getNewQuote(); 
            initAudio(); 
            
            checkDynamicTheme();
            setInterval(checkDynamicTheme, 60000);

            const bg = document.getElementById('breathingBg');
            
            setInterval(updateSoundButtonState, 500);

            bg.addEventListener('animationiteration', () => {
                cycleStartTime = performance.now();
                cycleCounter++;
                
                if (appMode === 'read' && cycleCounter >= updateInterval) {
                    cycleCounter = 0; 
                    getNewQuote();
                }
            });
        });
    </script>
</body>
</html>